<?php $items = $this->getApplicationList(); ?>
<?php $searchCriteria = $this->getInitSearchCriteria(); ?>

<div id="application-list">
    <?php if($size = $this->getCollectionCount()): ?>
        <div class="application-toolbar">
            <ul class="pages">
                <?php for($i=($size/9)<1?0:ceil($size/9) ; $i>0 ; $i--): ?>
                    <li data-page="<?php echo $i ?>"><?php echo $i ?></li>
                <?php endfor; ?>
            </ul>
        </div>
    <?php endif; ?>
    <div id="application-list-results">
        <?php if(count($items) > 0): ?>
            <ul class="app-notes">
                <?php foreach ($items as $item): ?>
                    <li class="application tab-content-cms <?php echo strtolower($item['sample_type']); ?>" data-application-id="<?php echo $item['application_id'] ?>" data-id="<?php echo $item['id'] ?>">
                        <a href="<?php echo $item['url'] ?>#nav-block" class="app-link" data-title="<?php $string = htmlspecialchars_decode($item['name']);echo $string;?>">
                        <div class="header">
                            <div class="sample-type">
                                <?php echo $item['sample_type']; ?>
                            </div>
                            <?php $files = $item['files']; ?>
                            <?php if($files->getSize()): ?>
                                <div class="pdf">
                                    <i class="fas fa-file-pdf fa-lg"></i>
                                </div>
                            <?php endif; ?>
                        </div>
                        <div class="info-wrapper">
                            <div class="app-info">
                                <div class="images">
                                    <img src="<?php echo $item['image'] ?>" alt="application image">
                                </div>
                                <div class="title">
                                    <span>Title:</span>
                                    <h3><?php
                                        $string = htmlspecialchars_decode($item['name']);
                                        echo $string;
                                        ?>
                                    </h3>
                                </div>
                                <div class="goal">
                                    <span>Goal:</span>
                                    <?php if(isset($item['goal'])): ?>
                                        <p><?php echo $item['goal'] ?></p>
                                    <?php else: ?>
                                        <p>Not available</p>
                                    <?php endif; ?>
                                </div>
                                <div class="description hidden">
                                    <p><?php echo $item['description'] ?></p>
                                </div>
                                <div class="products-used">
                                    <span>Products Used:</span>
                                    <?php if(isset($item['products'])): ?>
                                        <ul>
                                            <?php foreach ($item['products'] as $product): ?>
                                                <li>
                                                    <?php echo $product['product_name']; ?>
                                                </li>
                                            <?php endforeach; ?>
                                        </ul>
                                    <?php else: ?>
                                        <p>Not available</p>
                                    <?php endif; ?>
                                </div>
                                <div class="tags">
                                    <span>Tags:</span>
                                    <ul>
                                        <?php foreach ($item['tags'] as $tag): ?>
                                            <li>
                                            <!-- Temporary fix till revert all bead ruptor 24 protocols to elite - Travis -->
                                                <?php 
                                                    if($tag->getName() == 'Bead Ruptor 24'){
                                                        echo 'Bead Ruptor Elite';
                                                    }else {
                                                        echo $tag->getName();
                                                    }
                                                 ?>
                                            </li>
                                        <?php endforeach; ?>
                                    </ul>
                                </div>
                                <div class="created">
                                    <span>Created:</span>
                                    <p><?php echo date('Y-m-d', strtotime($item['created'])); ?></p>
                                </div>
                                <div class="pdf">
                                    <?php $files = $item['files']; ?>
                                    <?php if($files->getSize()): ?>
                                        <span>PDF:</span>
                                        <p>Included</p>
                                    <?php else: ?>
                                        <span>PDF:</span>
                                        <p>Not Included</p>
                                    <?php endif; ?>
                                </div>
                            </div>
                        </div></a>
                    </li>
                <?php endforeach; ?>
            </ul>
        <?php else: ?>
            <div class="no-results">
                <div style="margin: 10px 0;">
                    <p style="font-weight: 700; font-size: 18px; color: black;">Try simplifying your search to just a single word or term.</p><span>Still unable to find what you are looking for?</br> We will be more than happy to assist you, </br><a href="/contacts/" style="font-weight: 700; color: black;">click here for assistance.</span>
                    <img style="margin: 0; display: block;" src="http://unbxd.com/blog/wp-content/uploads/2014/02/No-results-found.jpg" alt="no results from search">
                    

                </div>
            </div>
        <?php endif; ?>
    </div>
    <?php if($size && $size > 5): ?>
        <div class="application-toolbar">
            <ul class="pages">
                <?php for($i=($size/9)<1?0:ceil($size/9) ; $i>0 ; $i--): ?>
                    <li data-page="<?php echo $i ?>"><?php echo $i ?></li>
                <?php endfor; ?>
            </ul>
        </div>
    <?php endif; ?>
    <?php if($size): ?>
        <script type="text/javascript">
            jQuery(function ($) {
                
                var loadingSVG = '<svg version="1.1" id="omni-spin" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 50 50.5" style="enable-background:new 0 0 50 50.5;" xml:space="preserve"><style type="text/css">.st0{fill:#444444;}</style><g><g><path id="omni-spin-in" class="st0" d="M27.2,27.7c0.1,0.5,0.1,1.1,0.2,1.6c0.1,0.5,0.1,1.1,0.4,1.6c0.5,1,0.8,2.1,1,3.2c0.2,1.2,0.1,2.4-0.1,3.5c-0.3,1.6-0.8,3.2-1.7,4.6c-1,1.5-2.3,2.6-3.7,3.5c-1.9,1.2-4,2.1-6,3c-0.3,0.1-0.7,0.3-1,0.4c0.1,0,0.1,0.1,0.2,0.1c1.9,0.7,3.8,1.1,5.8,1.4h0.8c1.8-0.5,3.6-1.1,5.3-1.9c1.7-0.8,3.4-1.6,4.9-2.9c2.7-2.3,4.2-5.3,4.3-8.9c0-0.1-0.1-0.2-0.1-0.3c-3.4-3.2-6.9-6.3-10.3-9.5c0,0-0.1-0.1-0.1-0.1C27,27.2,27.2,27.4,27.2,27.7 M45.8,11.4c-1.4,0.2-2.8,0.4-4.2,0.8c-3.7,1-6.3,3.3-7.9,6.8c-0.1,0.2-0.1,0.3,0.1,0.4c1.2,1,2.3,2,3.5,3c0.5,0.4,0.7,0.8,0.7,1.5c0,4.2,0,8.3,0,12.5c0,0.1,0,0.3,0.1,0.5c0.5,1.4,0.7,2.9,0.6,4.4c-0.1,1.8-0.6,3.6-1.5,5.2c-0.3,0.6-0.7,1.1-1.1,1.7c0.1,0,0.2-0.1,0.3-0.1c2.8-1.5,5.2-3.4,7.3-5.7c4.1-4.8,6.2-10.3,6.4-16.6v-0.6c0-1.6-0.2-3.2-0.5-4.7c-0.6-3.1-1.7-6-3.4-8.6C46.1,11.5,46,11.4,45.8,11.4L45.8,11.4 M38.9,4.2c-0.9,0.3-1.7,0.5-2.6,0.8c-2.5,0.9-5,1.9-7.3,3.3c-1.6,1-3.1,2.2-4.2,3.7c-1.1,1.6-1.8,3.4-2.1,5.3c-0.2,1.2-0.2,2.3,0,3.5c0.1,0.8,0.3,1.6,0.5,2.5c0.1,0.4,0.1,0.7,0.2,1.1c0.1,0.3,0.2,0.5,0.2,0.8c0,1.5,0,2.9,0,4.4c0,2.5-0.1,5.1-0.1,7.6c0,0.1-0.1,0.2-0.1,0.4c-0.1-0.1-0.2-0.1-0.3-0.1c-1.9-1.6-3.7-3.2-5.6-4.8c-0.1-0.1-0.1-0.1-0.2-0.2c-0.2,2.8-1.5,5.1-3.3,7.2c-1.9,2.1-4.3,2.9-7,3.4c0,0.1,0,0.1,0.1,0.1c1.3,1.3,2.7,2.5,4.3,3.5c0.1,0,0.2,0.1,0.2,0c0.5-0.2,1.1-0.3,1.6-0.5c2.8-0.9,5.5-2.1,8.1-3.6c1.6-1,3-2.2,4.1-3.8c1.1-1.6,1.8-3.4,2-5.4c0.1-1,0.1-2.1,0-3.1c-0.1-0.9-0.3-1.8-0.5-2.7c-0.1-0.3-0.1-0.6-0.2-0.9c-0.1-0.3-0.2-0.5-0.2-0.8c0-1.4,0-2.9,0.1-4.3c0-2.4,0.1-4.8,0.1-7.3c0-0.2,0-0.4,0-0.6c0-0.2,0.2-0.3,0.3-0.1c0,0,0.1,0.1,0.1,0.1c1.9,1.6,3.7,3.2,5.6,4.8c0.1,0,0.1,0.1,0.2,0.1c0-0.4,0.1-0.7,0.1-1c0.7-3.2,2.3-5.8,4.9-7.7c1.4-1,2.9-1.4,4.5-1.7c0.3-0.1,0.6-0.1,1-0.2c0-0.1-0.1-0.1-0.1-0.1c-1.2-1.3-2.6-2.5-4.1-3.6c-0.1,0-0.1-0.1-0.2-0.1C39,4.2,39,4.2,38.9,4.2 M15.5,1.6c-0.1,0-0.1,0-0.1,0.1C11.7,3.2,8.6,5.4,6,8.5c-3.5,4.2-5.5,9-6,14.3v4.9c0.1,0.7,0.2,1.4,0.3,2.1c0.6,3.5,1.9,6.7,3.8,9.6c0.1,0.1,0.2,0.2,0.3,0.1c1.5-0.2,3-0.4,4.5-0.9c3.5-1.1,6-3.3,7.5-6.7c0.1-0.1,0-0.2-0.1-0.3c-1.2-1-2.4-2.1-3.6-3.1c-0.4-0.3-0.6-0.7-0.6-1.3c0-4.2,0-8.4,0-12.6c0-0.1,0-0.3-0.1-0.4c-0.4-1.3-0.7-2.5-0.6-3.8c0-1,0.2-2.1,0.4-3.1c0.5-2,1.5-3.8,3-5.3C15.1,2,15.3,1.8,15.5,1.6L15.5,1.6L15.5,1.6 M28.3,0.1c-1.2,0.4-2.5,0.7-3.7,1.2c-2,0.7-3.9,1.5-5.7,2.6c-1.9,1.2-3.5,2.7-4.6,4.7c-0.9,1.6-1.3,3.3-1.5,5.1c0,0.4,0.1,0.7,0.4,1c2.2,2,4.3,4,6.5,6c1.2,1.1,2.5,2.3,3.7,3.4c-0.1-0.1-0.1-0.3-0.2-0.4c0-0.1-0.1-0.2-0.1-0.3c-0.1-0.7-0.1-1.4-0.2-2c0-0.4-0.1-0.7-0.3-1c-0.5-1-0.9-2.1-1.1-3.3c-0.2-1.2-0.2-2.5,0.1-3.7c0.3-1.8,0.9-3.6,2.1-5.1c0.9-1.2,2.1-2.2,3.3-3c1.9-1.2,3.9-2.1,5.9-2.9c0.6-0.2,1.1-0.4,1.7-0.7c-0.1,0-0.1-0.1-0.2-0.1c-1.6-0.7-3.3-1.1-5-1.5C29.1,0,29,0,28.8,0C28.6,0,28.4,0,28.3,0.1"></path></g></g></svg>';
                $('.app-ajax').on('click', function(e){
                    e.preventDefault();
                    var get_url = $(this).data('url');
                    if(!$('#app-database-container').length){
                        $('body').append('<div id="app-database-container" />');
                    }
                    $('#app-database-container').removeClass('closed');
                    $('#app-database-container').html('<div class="' + searchLoader + '">'+loadingSVG+'<strong>Still loading...</strong></div>');

                    $.ajax({
                        type: 'GET',
                        url: get_url,
                        success: function (data) {
                            $('#app-database-container').html(
                                $(data).find('#app-database-container').html()
                            );
                        }, error: function (xhr, ajaxOptions, thrownError) {
                            console.log(xhr.responseText);
                            console.log(thrownError);
                        }
                    });
                });

                $('.application-toolbar').pagination({
                    items: <?php echo $size; ?>,
                    itemsOnPage: 9,
                    cssStyle: 'light-theme',
                    onPageClick: function(pageNumber, event){
                        var target = $('.application-result #application-list-results'),
                            searchLoader = 'application-loader',
                            ajaxResult = '#application-list-results',
                            summary = $('#application-summary');
                        var get_url = '<?php echo $this->getAction(); ?>';
                        var get_data = summary.html();
                        var get_data_arr = get_data.split('&amp;');

                        for(var i=0;i<get_data_arr.length;i++){
                            var data = get_data_arr[i].split('=');
                            if(data[0] == 'filter%5Bpage%5D'){
                                data[1] = pageNumber;
                            }
                            data = data[0]+'='+data[1];
                            get_data_arr[i] = data;
                        }
                        get_data_arr.push('filter%5Btotal_count%5D=<?php echo $size; ?>');
                        get_data = get_data_arr.join('&');

                        $(target).removeClass('open').addClass('appLoading');
                        $(target).html('<div class="' + searchLoader + '">'+loadingSVG+'<strong>Still loading...</strong></div>');
                        $.ajax({
                            type: 'GET',
                            url: get_url,
                            data: get_data,
                            success: function (data) {
                                summary.html(get_data);
                                $(target).removeClass('appLoading');
                                $(target).find('.' + searchLoader).remove();
                                $(target).append(
                                    $(data).find(ajaxResult).html()
                                );
                                $('#application-list-results ul').find('.application').matchHeight({byRow: true});
                                $(target).addClass('open');
                            }, error: function (xhr, ajaxOptions, thrownError) {
                                console.log(xhr.responseText);
                                console.log(thrownError);
                                $(target).find('.' + searchLoader).remove();
                            }
                        });
                    }
                });
            });
        </script>
    <?php endif; ?>
</div>
<script>
jQuery(function ($) {
    var featured = $('#featuredApp');
    function test(){
        //$('.app-notes').find('.title').matchHeight({byRow: true});
        $('.featured-item').find('.col').matchHeight();
    }
    function featuredApplications(){
        if(!featured.hasClass('hideFeatured')){
            var item = $('ul').find('.application');
            //$('.application-result').css('display', 'none');
            $('.app-link').on('click', function(e){
                e.preventDefault();
            });
            function shorten(text, maxLength) {
                var ret = text;
                if (ret.length > maxLength) {
                    ret = ret.substr(0,maxLength-3) + '… <a href="#fullDesc"><small>open to see full description.</small></a>';
                }
                return ret;
            }
            item.each(function(index){
                var title = $(this).find('.title h3').html(),
                dataId = $(this).attr('data-id'),
                sample = $(this).find('.sample-type').html(),
                goal = $(this).find('.goal p').html(),
                products = $(this).find('.products-used ul').html(),
                created = $(this).find('.created p').html(),
                urlLink = $(this).find('.app-link').attr('href'),
                imageLink = $(this).find('.images img').attr('src'),
                description = $(this).find('.description p').html();
                pdf = $(this).find('.pdf').html();         
                var description = shorten(description, 200);
                description = description.replace('#fullDesc', urlLink);
                $(this).find('.overlay').css('display', 'none');
                $(this).find('.products-used').css('display', 'none');
                $(this).find('.goal').css('display', 'none');
                $(this).find('.tags').css('display', 'none');
        
                if(pdf !== undefined || pdf !== null){
                    pdf = '<i class="fas fa-file-pdf fa-lg"></i>';
                }else{
                    pdf = '';
                }
                if(index === 0){
                    $(this).addClass('active');
                    var el = '<div class="featured-item tab-content-cms active" data-id="'+dataId+'">';
                }else{
                    var el = '<div class="featured-item tab-content-cms" data-id="'+dataId+'">';
                }
                    el += '<div class="left-col col">';
                        el += '<div class="title">';
                            el += title;
                        el += '</div>';
                        el += '<div class="image">';
                            el += '<img class="featured-img" style="height: 100%;" src="'+imageLink+'" alt="Test image" >';
                        el += '</div>';
                    el += '</div>';
                    el += '<div class="right-col col">';
                        el += '<div class="header">';
                          el += '<div class="sample-type '+sample.toLowerCase()+'">'+sample+'</div>';
                          el += '<div class="pdf">'+pdf+'</div>';
                        el += '</div>';
                        el += '<div class="inner-wrapper">';
                          el += '<div class="goal info"><strong>Goal:</strong>';
                            el += goal;
                          el += '</div>';
                          el += '<div class="description info"><strong>Description:</strong>';
                            el += description;
                          el += '</div>';
                          el += '<div class="products-used info"><strong>Products used:</strong>';
                            el += products;
                          el += '</div>';
                          el += '<div class="created info"><strong>Created:</strong>';
                            el += created;
                          el += '</div>';
                          el += '<div class="view-note">';
                            el += '<a class="btn btn-solid" href="'+urlLink+'">Click here to open Application</a>';
                          el += '</div>';
                        el += '</div>';
                    el += '</div>';
                el += '</div>';
            
                $('#application-list-results').prepend(el);
            });
        }
        item.on('click', function(e){
            if($(this).hasClass('active')){
                e.preventDefault();
                return;
            }
            var id = $(this).attr('data-id');
            item.removeClass('active');
            $(this).addClass('active');
            $('.featured-item').removeClass('active');
            var activeItem = $('[data-id="'+id+'"]');
            activeItem.addClass('active');
            if ($(window).innerWidth() < 730) {
                if(window.location.hash = '#application-list'){
                    window.location.hash = '#application-list-results'
                }else{
                    window.location.hash = '#application-list';
                }
            }
            
            
        });
    }featuredApplications();
    if ($(window).innerWidth() > 730) {
        test();
    }
    $(window).resize(function() {
        if($(window).innerWidth() > 730){
            test();
        }
    });

    <?php if(
        (isset($searchCriteria['name']) && $searchCriteria['name'] != '%%') ||
        isset($searchCriteria['sampletype_id']) || isset($searchCriteria['product_id'])
    ): ?>
    $('#application-search-form').submit();
    <?php endif; ?>
});
</script>


