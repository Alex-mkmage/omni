<?php /** @var VladimirPopov_WebForms_Block_Customer_Account_Results $this */ ?>

<?php if ($this->getCollection()->getSize() || !$this->getPermission('add')): ?>
    <?php echo $this->getChildHtml('toolbar') ?>
    <table class="data-table box-table" id="webform-customer-account-results" cellspacing="0">
        <col width="65"/>
        <col width="220"/>
        <col width="170"/>
        <?php if (Mage::registry('webform')->getApprove()): ?>
            <col width="60"/>
        <?php endif; ?>
        <?php if (
            $this->getPermission('edit')
            || $this->getPermission('delete')
            || $this->getPermission('print')
            || $this->getPermission('reply')) { ?>
            <col width="60"/>
        <?php } ?>
        <thead>
        <tr>
            <th><?php echo $this->__('ID') ?></th>
            <th><?php echo $this->__('Subject') ?></th>
            <th><?php echo $this->__('Date') ?></th>
            <?php if (Mage::registry('webform')->getApprove()): ?>
                <th><?php echo $this->__('Status') ?></th>
            <?php endif; ?>
            <?php if (
                $this->getPermission('edit')
                || $this->getPermission('delete')
                || $this->getPermission('print')
                || $this->getPermission('reply')
            ) { ?>
                <th><?php echo $this->__('Action') ?></th>
            <?php } ?>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($this->getCollection() as $result): ?>
            <?php /** @var VladimirPopov_WebForms_Model_Results $result */ ?>
            <tr>
                <td style="white-space:nowrap;"><?php echo $result->getId() ?></td>
                <td title="<?php echo $this->escapeHtml($result->getEmailSubject()); ?>">
                    <?php if ($this->getPermission('view')) { ?>
                        <a href="<?php echo $this->getUrlResultView($result) ?>"><?php echo $result->getEmailSubject() ?></a>
                    <?php } else { ?>
                        <?php echo $result->getEmailSubject() ?>
                    <?php } ?>
                </td>
                <td><?php echo Mage::helper('core')->formatDate($result->getCreatedTime(), 'medium', true); ?></td>
                <?php if (Mage::registry('webform')->getApprove()): ?>
                    <td><?php echo $this->getApproveStatus($result) ?></td>
                <?php endif; ?>
                <?php if (
                    $this->getPermission('edit')
                    || $this->getPermission('delete')
                    || $this->getPermission('print')
                    || $this->getPermission('reply')) { ?>
                    <td>
                        <?php if ($this->getPermission('edit')) { ?>
                            <a class="webforms-result-action result-action-edit"
                               href="<?php echo $this->getUrlResultEdit($result) ?>"><?php echo $this->__('Edit') ?></a>
                        <?php } ?>
                        <?php if ($this->getPermission('print')) { ?>
                            <a class="webforms-result-action result-action-print"
                               href="<?php echo $this->getUrlResultPrint($result) ?>"><?php echo $this->__('Print') ?></a>
                        <?php } ?>
                        <?php if ($this->getPermission('delete')) { ?>
                            <a class="webforms-result-action result-action-delete"
                               href="javascript:if(confirm('<?php echo Mage::helper('webforms')->__('Are you sure?') ?>')){setLocation('<?php echo $this->getUrlResultDelete($result) ?>')}"><?php echo $this->__('Delete') ?></a>
                        <?php } ?>

                    </td>
                <?php } ?>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
    <script type="text/javascript">decorateTable('webform-customer-account-results')</script>
    <?php echo $this->getChildHtml('toolbar') ?>
    <div class="buttons-set">
        <p class="back-link"><a href="javascript:window.history.back()">
                <small>&laquo;</small><?php echo $this->__('Back') ?></a></p>

        <?php if ($this->getPermission('add')) { ?>
            <button type="button" class="button"
                    id="webforms-show-form"
                    onclick="this.hide();$('webforms-hide-form').show();Effect.SlideDown('webforms-customer-account-form',{duration:0.1});"
                    title="<?php echo $this->__('Show Form') ?>">
			<span>
				<span><?php echo $this->__('Show Form') ?></span>
			</span>
            </button>
        <?php } ?>

        <button type="button" class="button"
                id="webforms-hide-form"
                style="display: none"
                onclick="this.hide();$('webforms-show-form').show();Effect.SlideUp('webforms-customer-account-form',{duration:0.1});"
                title="<?php echo $this->__('Hide Form') ?>">
			<span>
				<span><?php echo $this->__('Hide Form') ?></span>
			</span>
        </button>
    </div>
<?php endif; ?>